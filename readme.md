# ðŸ“˜ äºŒç»´äº‘å°æŽ§åˆ¶ç³»ç»Ÿï¼ˆ2D Gimbal Control Systemï¼‰

æœ¬é¡¹ç›®åŸºäºŽ **FreeRTOS + CAN æ€»çº¿ + IMU å®šæ—¶ä¸­æ–­**ï¼Œå®žçŽ°ç²¾ç»†åŒ–çš„äºŒç»´äº‘å°æŽ§åˆ¶ã€‚ç³»ç»Ÿé‡‡ç”¨ **åŒçŽ¯æŽ§åˆ¶ï¼ˆè§’åº¦çŽ¯ + é€Ÿåº¦çŽ¯ï¼‰**ï¼Œç»“åˆè§†è§‰å’Œé¥æŽ§è¾“å…¥ï¼Œå®žçŽ°ç›®æ ‡è·Ÿè¸ªå’Œç¨³å®šæŽ§åˆ¶ã€‚



//test
---

## ðŸ”¹ å½“å‰å¾…å®Œæˆä»»åŠ¡

* PID è¿ç®—é€»è¾‘ï¼ˆå¼€å‘ä¸­ï¼‰
* IMU åˆå§‹åŒ–ä¸Žå§¿æ€è§’è¯»å–ï¼ˆä¾èµ–äº‘å°å½’ä¸­å®Œæˆï¼‰
* è°ƒç”¨è§†è§‰ä¼ å›žçš„ç›®æ ‡æ•°æ®è¿›è¡Œäº‘å°æŽ§åˆ¶

---

## ðŸ”¹ ç³»ç»ŸåŠŸèƒ½æ¦‚è§ˆ

### 1. IMU æ•°æ®é‡‡é›†

* é€šè¿‡ **å®šæ—¶å™¨ä¸­æ–­**è¯»å– IMU åŽŸå§‹æ•°æ®
* å§¿æ€è§£ç®—ï¼ˆäº’è¡¥æ»¤æ³¢ / å¡å°”æ›¼æ»¤æ³¢ï¼‰ï¼Œå¾—åˆ° Pitchã€Yaw è§’åº¦ä¸Žè§’é€Ÿåº¦
* ä¸ºæŽ§åˆ¶çŽ¯è·¯æä¾›å®žæ—¶åé¦ˆ

---

### 2. ç›®æ ‡åå·®è®¡ç®—

* è¾“å…¥æ¥æºï¼šè§†è§‰æ¨¡å—+è™šæ‹Ÿä¸²å£
* å°†å›¾åƒåæ ‡ç³»ä¸­çš„ç›®æ ‡ä½ç½®è½¬æ¢ä¸ºè§’åº¦åå·®
* è¾“å‡ºç›®æ ‡ç›¸å¯¹äºŽäº‘å°ä¸­å¿ƒçš„è¯¯å·®è§’

---

### 3. æœŸæœ›è§’åº¦è®¾å®š

* **é¥æŽ§è¾“å…¥**ï¼šç”¨æˆ·æ‰‹åŠ¨è®¾å®šæœŸæœ›è§’åº¦
* **è§†è§‰è¾“å…¥**ï¼šæ ¹æ®ç›®æ ‡åå·®è‡ªåŠ¨ä¿®æ­£æœŸæœ›è§’åº¦
* æ”¯æŒä¸¤è€…ç»„åˆï¼Œä¾‹å¦‚ï¼šé»˜è®¤ä¿æŒé¥æŽ§ï¼Œè§†è§‰æ¨¡å¼å¯åŠ¨æ—¶æŽ¥ç®¡

---

### 4. å¤–çŽ¯æŽ§åˆ¶ï¼ˆè§’åº¦çŽ¯ï¼‰

* è¾“å…¥ï¼šæœŸæœ›è§’åº¦ä¸Žå½“å‰è§’åº¦å·®å€¼
* è¾“å‡ºï¼šæœŸæœ›è§’é€Ÿåº¦
* æŽ§åˆ¶å™¨ï¼šä½Žå¸¦å®½ PIDï¼Œé˜²æ­¢å¤§å¹…æŒ¯è¡

---

### 5. å†…çŽ¯æŽ§åˆ¶ï¼ˆé€Ÿåº¦çŽ¯ / è§’é€Ÿåº¦çŽ¯ï¼‰

* è¾“å…¥ï¼šæœŸæœ›è§’é€Ÿåº¦ä¸Ž IMU æµ‹å¾—è§’é€Ÿåº¦å·®å€¼
* è¾“å‡ºï¼šç”µæœº PWM / ç”µæµæŒ‡ä»¤
* æŽ§åˆ¶å™¨ï¼šé«˜é€Ÿ PIDï¼Œé«˜å¸¦å®½ï¼Œæå‡åŠ¨æ€å“åº”ä¸ŽæŠ—æ‰°èƒ½åŠ›

---

### 6. ç”µæœºæŽ§åˆ¶è¾“å‡º

* é€šè¿‡ **CAN æ€»çº¿**å‘é€æŽ§åˆ¶å‘½ä»¤åˆ°ç”µæœºé©±åŠ¨
* CAN ä»»åŠ¡è´Ÿè´£æ”¶å‘ç”µæœºæŽ§åˆ¶å¸§ä¸Žåé¦ˆæ•°æ®

---

### 7. ä»»åŠ¡è°ƒåº¦ä¸Žç³»ç»Ÿç»“æž„

* **IMU å®šæ—¶ä¸­æ–­**ï¼šé«˜ä¼˜å…ˆçº§ï¼Œä¿è¯å§¿æ€è§£ç®—å®žæ—¶æ€§
* **äº‘å°æŽ§åˆ¶ä»»åŠ¡**ï¼šæ‰§è¡Œè§’åº¦çŽ¯ + é€Ÿåº¦çŽ¯æŽ§åˆ¶é€»è¾‘
* **CAN é€šä¿¡ä»»åŠ¡**ï¼šç”µæœºå‘½ä»¤å‘é€ä¸Žåé¦ˆæŽ¥æ”¶
* **è§†è§‰ä»»åŠ¡**ï¼šç›®æ ‡æ£€æµ‹ä¸Žåå·®è®¡ç®—
* ä½¿ç”¨ `vTaskDelayUntil` ä¿è¯ä»»åŠ¡å‘¨æœŸç¨³å®š

---

## ðŸ”¹ äº‘å°æŽ§åˆ¶é€»è¾‘æµç¨‹

1. **åé¦ˆè¯»å–**ï¼šå°†å½“å‰äº‘å°çŠ¶æ€ä¸Žä¼ æ„Ÿå™¨åé¦ˆå­˜å…¥ç»“æž„ä½“
2. **å½’ä¸­æ£€æµ‹**ï¼šæ ¹æ®æ ‡å¿—ä½åˆ¤æ–­æ˜¯å¦éœ€è¦å½’ä¸­ï¼Œæœªå½’ä¸­æ—¶æ‰§è¡Œå½’ä¸­æŽ§åˆ¶
3. **é™å¹…å¤„ç†**ï¼šè§’åº¦è¶…è¿‡é¢„è®¾èŒƒå›´æ—¶è¿›è¡Œé™å¹…ä¿®æ­£
4. **PID è¿ç®—**ï¼šä»¥å§¿æ€è§’ + å¢žé‡è§’åº¦ï¼ˆaddï¼‰è¿›è¡Œ PID è®¡ç®—ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡º
5. **CAN è¾“å‡º**ï¼šé€šè¿‡ CAN ä»»åŠ¡å‘é€ç»™ç”µæœºæ‰§è¡Œ

---

## ðŸ”¹ ç³»ç»Ÿæ¶‰åŠè§’åº¦è¯´æ˜Ž

| è§’åº¦ç±»åž‹       | æè¿°                     |
| ---------- | ---------------------- |
| ç”µæœºæœºæ¢°è§’åº¦     | ç”µæœºæ—‹è½¬å®žé™…ä½ç½®               |
| IMU å§¿æ€è§’    | IMU è§£ç®—å¾—åˆ°çš„ Pitch/Yaw è§’åº¦ |
| é¥æŽ§/PC è¾“å…¥è§’åº¦ | ç”¨æˆ·è®¾å®šçš„æœŸæœ›è§’åº¦ï¼ˆç”¨äºŽåŠ æ³•å¢žé‡è®¡ç®—ï¼‰    |
| ä¸­å€¼è§’åº¦       | äº‘å°å½’ä¸­æ—¶æ ¡å‡†çš„åŸºå‡†è§’åº¦           |
| ç»å¯¹è§’åº¦       | å½“å‰åé¦ˆè§’åº¦ï¼ˆæœºæ¢°è§’ + å§¿æ€è§’ï¼‰      |
| ç›¸å¯¹è§’åº¦       | ç»å¯¹è§’åº¦ä¸Žä¸­å€¼è§’åº¦ä¹‹å·®ï¼ˆå–æœ€å°æ­£å€¼ï¼‰     |
| è¯¯å·®è§’åº¦       | æœŸæœ›è§’åº¦ä¸Žå½“å‰è§’åº¦å·®å€¼ï¼Œç”¨äºŽ PID è¿ç®—  |

**é™å¹…é€»è¾‘ç¤ºä¾‹**ï¼š

* ä¸­å€¼è§’åº¦ï¼š3000 ~ 6000
* å½“ç›¸å¯¹è§’åº¦ + add è¶…å‡ºèŒƒå›´æ—¶ï¼Œè¿›è¡Œå›žæŒ¯æˆ–é™åˆ¶
* è®¾ç½®è§’åº¦ä¸ºä¸­å€¼è§’åº¦ä»¥ä¿è¯å®‰å…¨

---

## ðŸ”¹ å¾…è§£å†³é—®é¢˜ / æ³¨æ„äº‹é¡¹

1. äº‘å°å½’ä¸­é¡ºåºï¼šå…ˆè½¬ Yaw è½´è¿˜æ˜¯ Pitch è½´ï¼Ÿä¸¤è½´åŒæ—¶å½’ä¸­æ˜¯å¦å®‰å…¨ï¼Ÿ
2. IMU ä¸Šç”µå§¿æ€è§’é»˜è®¤å½’é›¶ï¼Œå½’ä¸­åŽä¼šæœ‰åˆå§‹åç§»å€¼ï¼Œæ˜¯å¦éœ€è¦æ ¡æ­£ï¼Ÿ

---

## ðŸ”¹ ç³»ç»Ÿé€»è¾‘å›¾

```mermaid
flowchart TD
    IMU[IMU å®šæ—¶ä¸­æ–­] -->|å§¿æ€è§£ç®—| CTRL[äº‘å°æŽ§åˆ¶ä»»åŠ¡]
    VISION[è§†è§‰ä»»åŠ¡] -->|ç›®æ ‡åå·®| CTRL
    RC[é¥æŽ§è¾“å…¥] -->|æœŸæœ›è§’åº¦| CTRL

    CTRL -->|è§’åº¦çŽ¯è¾“å‡º: Ï‰_set| RATE[é€Ÿåº¦çŽ¯æŽ§åˆ¶]
    RATE -->|æŽ§åˆ¶ç”µæµ/æ‰­çŸ©| CAN[CANä»»åŠ¡]
    CAN --> MOTOR[ç”µæœºæ‰§è¡Œ]
    MOTOR -->|åé¦ˆ| CAN
    CAN --> CTRL
```
