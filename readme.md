# ðŸ“˜ äºŒç»´äº‘å°æŽ§åˆ¶ç³»ç»Ÿ

æœ¬é¡¹ç›®åŸºäºŽ **FreeRTOS + CAN æ€»çº¿ + IMU å®šæ—¶ä¸­æ–­** å®žçŽ°ç²¾ç»†åŒ–çš„äºŒç»´äº‘å°æŽ§åˆ¶ï¼Œé‡‡ç”¨ **åŒçŽ¯æŽ§åˆ¶ï¼ˆè§’åº¦çŽ¯ + é€Ÿåº¦çŽ¯ï¼‰**ï¼Œç»“åˆè§†è§‰ä¸Žé¥æŽ§è¾“å…¥ï¼Œå®žçŽ°ç›®æ ‡è·Ÿè¸ªä¸Žç¨³å®šæŽ§åˆ¶ã€‚

---

## ðŸ”¹å½“å‰ä»»åŠ¡ï¼ˆå¾…å®Œæˆï¼‰

* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…
* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…
* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…
* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…
* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…
* 1. **CANæ”¶å‘å‡½æ•°**ç¼–å†™/ç§»æ¤ä»¥åŠå°è£…



## ðŸ”¹ ç³»ç»Ÿä¸»è¦ä»»åŠ¡

### 1. **IMU æ•°æ®é‡‡é›†**

* é€šè¿‡ **å®šæ—¶å™¨ä¸­æ–­**è¯»å– IMU åŽŸå§‹æ•°æ®ã€‚
* è¿›è¡Œå§¿æ€è§£ç®—ï¼ˆäº’è¡¥æ»¤æ³¢ / å¡å°”æ›¼æ»¤æ³¢ï¼‰ï¼Œå¾—åˆ° Pitchã€Yaw è§’åº¦ä¸Žè§’é€Ÿåº¦ã€‚
* ä¸ºæŽ§åˆ¶çŽ¯è·¯æä¾›å®žæ—¶åé¦ˆã€‚

---

### 2. **ç›®æ ‡åå·®è®¡ç®—**

* æ¥è‡ªè§†è§‰æ¨¡å—ã€‚
* å°†å›¾åƒåæ ‡ç³»ä¸­çš„ç›®æ ‡ä½ç½®è½¬åŒ–ä¸ºè§’åº¦åå·®ã€‚
* è¾“å‡ºç›®æ ‡ç›¸å¯¹äºŽäº‘å°ä¸­å¿ƒçš„è¯¯å·®è§’ã€‚

---

### 3. **è®¾å®šè§’åº¦æ¥æº**

* **é¥æŽ§è¾“å…¥**ï¼šç”¨æˆ·æ‰‹åŠ¨è®¾å®šæœŸæœ›è§’åº¦ã€‚
* **è§†è§‰è¾“å…¥**ï¼šæ ¹æ®ç›®æ ‡åå·®è‡ªåŠ¨ä¿®æ­£æœŸæœ›è§’åº¦ã€‚
* ä¸¤è€…å¯ç»„åˆï¼ˆä¾‹å¦‚ï¼šé»˜è®¤ä¿æŒé¥æŽ§ï¼Œè§†è§‰è¿›å…¥è‡ªåŠ¨è·Ÿè¸ªæ¨¡å¼æ—¶æŽ¥ç®¡ï¼‰ã€‚

---

### 4. **å¤–çŽ¯æŽ§åˆ¶ï¼ˆè§’åº¦çŽ¯ï¼‰**

* è¾“å…¥ï¼šæœŸæœ›è§’åº¦ä¸Žå½“å‰è§’åº¦çš„å·®å€¼ã€‚
* è¾“å‡ºï¼šæœŸæœ›è§’é€Ÿåº¦ã€‚
* æŽ§åˆ¶å™¨ï¼šPIDï¼ˆä½Žå¸¦å®½ï¼Œé˜²æ­¢å¤§å¹…æŒ¯è¡ï¼‰ã€‚

---

### 5. **å†…çŽ¯æŽ§åˆ¶ï¼ˆé€Ÿåº¦çŽ¯ / è§’é€Ÿåº¦çŽ¯ï¼‰**

* è¾“å…¥ï¼šæœŸæœ›è§’é€Ÿåº¦ä¸Ž IMU è§’é€Ÿåº¦å·®å€¼ã€‚
* è¾“å‡ºï¼šç”µæœºç”µæµ / PWM æŒ‡ä»¤ã€‚
* æŽ§åˆ¶å™¨ï¼šé«˜é€Ÿ PIDï¼ˆé«˜å¸¦å®½ï¼Œæå‡åŠ¨æ€å“åº”å’ŒæŠ—æ‰°èƒ½åŠ›ï¼‰ã€‚

---

### 6. **è¾“å‡ºåˆ°ç”µæœº**

* æŽ§åˆ¶å‘½ä»¤é€šè¿‡ **CAN æ€»çº¿** å‘é€åˆ°ç”µæœºé©±åŠ¨ã€‚
* CAN ä»»åŠ¡åœ¨ RTOS ä¸­è¿è¡Œï¼Œè´Ÿè´£æ”¶å‘ç”µæœºæŽ§åˆ¶å¸§ä¸Žåé¦ˆæ•°æ®ã€‚

---

### 7. **ä»»åŠ¡è°ƒåº¦ä¸Žç»“æž„ä¼˜åŒ–**

* **IMU å®šæ—¶ä¸­æ–­**ï¼šé«˜ä¼˜å…ˆçº§ï¼Œä¿è¯å§¿æ€è§£ç®—å®žæ—¶æ€§ã€‚
* **äº‘å°æŽ§åˆ¶ä»»åŠ¡ï¼ˆ1kHzï¼‰**ï¼šæ ¸å¿ƒæŽ§åˆ¶çŽ¯ï¼Œè¿è¡Œè§’åº¦çŽ¯ + é€Ÿåº¦çŽ¯æŽ§åˆ¶é€»è¾‘ã€‚
* **CAN é€šä¿¡ä»»åŠ¡**ï¼šè´Ÿè´£ç”µæœºå‘½ä»¤å‘é€ä¸ŽçŠ¶æ€æŽ¥æ”¶ã€‚
* **è§†è§‰ä»»åŠ¡ï¼ˆ30Hzï¼‰**ï¼šè´Ÿè´£ç›®æ ‡æ£€æµ‹ä¸Žåå·®è®¡ç®—ã€‚
* **å»¶æ—¶/å®šæ—¶**ï¼šé€šè¿‡ FreeRTOS `vTaskDelayUntil` ä¿è¯ä»»åŠ¡å‘¨æœŸç¨³å®šã€‚

---

## ðŸ”¹ ç³»ç»Ÿæž¶æž„å›¾ï¼ˆé€»è¾‘ï¼‰

```mermaid
flowchart TD
    IMU[IMUå®šæ—¶ä¸­æ–­] -->|å§¿æ€è§£ç®—| CTRL[äº‘å°æŽ§åˆ¶ä»»åŠ¡]
    VISION[è§†è§‰ä»»åŠ¡] -->|ç›®æ ‡åå·®| CTRL
    RC[é¥æŽ§è¾“å…¥] -->|æœŸæœ›è§’åº¦| CTRL

    CTRL -->|è§’åº¦çŽ¯è¾“å‡º: Ï‰_set| RATE[é€Ÿåº¦çŽ¯æŽ§åˆ¶]
    RATE -->|æŽ§åˆ¶ç”µæµ/æ‰­çŸ©| CAN[CANä»»åŠ¡]
    CAN --> MOTOR[ç”µæœºæ‰§è¡Œ]
    MOTOR -->|åé¦ˆ| CAN
    CAN --> CTRL
```



